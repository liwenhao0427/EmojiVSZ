
# Keyboard Defense: Grid Tactics - Game Design Document

## 1. 项目概况
这是一个结合了 **网格战术 (Grid Tactics)** 和 **自动战斗 (Auto-Battler)** 元素的塔防游戏。玩家在一个 5x9 的棋盘上布置 "键盘侠" 英雄和雇佣兵单位，抵御从右侧不断涌来的网络水军（Trolls）。

**核心体验:**
*   **策略布局**: 不同的单位攻击范围和攻击方式不同，位置决定效率。
*   **Roguelite 循环**: 战斗 -> 选秀 (Draft) -> 商店 (Shop) -> 战斗。
*   **视觉风格**: 霓虹科技风 (Neon/Cyber) + Emoji 角色。

**技术栈:**
*   **前端**: React 18, Tailwind CSS
*   **核心逻辑**: HTML5 Canvas (GameEngine.ts)
*   **状态管理**: Zustand
*   **交互**: 鼠标拖拽 (Drag & Drop) 调整站位

---

## 2. 核心机制

### 2.1 战场网格 (Battlefield Grid)
*   **规格**: 5行 x 9列 的棋盘。
*   **单位 (Units)**: 
    *   每个格子只能放置一个单位。
    *   玩家可以在非战斗阶段（SHOP/DRAFT 阶段）随意拖拽交换单位位置。
    *   **英雄 (Hero)**: 玩家的主要角色（键盘侠），拥有能量条和终极技能（大招）。
    *   **雇佣兵 (Mercenaries)**: 招募的辅助单位，拥有各自的生命值和攻击模式。

### 2.2 战斗流程 (Combat Phase)
*   **自动攻击**: 
    *   单位根据自身的 **射程 (Range)** 和 **冷却 (Cooldown)** 自动寻找最近的同行或范围内敌人进行攻击。
    *   **弹丸 (Projectiles)**: 大多数远程单位发射与其形象相关的 Emoji 弹幕。
*   **敌人机制**:
    *   从屏幕右侧生成，沿行向左移动。
    *   如果碰到单位，会进行近战攻击扣除单位 HP。
    *   如果突破防线（到达左侧边缘），游戏结束。
*   **终极技能 (Ultimate)**:
    *   英雄通过时间自动恢复能量。
    *   能量满 (100) 时自动释放全屏攻击（如 "ULTIMATE!" 文字轰炸），冻结并伤害所有敌人。

### 2.3 游戏循环 (Game Loop)

1.  **COMBAT (战斗)**: 
    *   抵御一波敌人。
    *   单位死亡后会在下一波复活（除非是临时单位）。
2.  **DRAFT (选秀)**:
    *   波次结束后的奖励阶段。
    *   玩家从 3 个随机选项中选择 1 个：
        *   **Mercenary**: 获得一个新的单位（通常是临时或永久，视具体设定）。
        *   **Buff**: 获得当前波次的强力属性加成（如 +50% 伤害）。
3.  **SHOP (商店)**:
    *   使用金币 (Gold) 购买永久强化或新单位。
    *   **Reroll**: 花费金币刷新商品。
    *   **Lock**: 锁定商品不被刷新。
    *   玩家在此阶段可以调整网格阵型。

---

## 3. 数值体系

### 3.1 玩家属性 (PlayerStats)
这些属性主要影响全局加成或英雄能力：

| 属性 | 作用 |
| :--- | :--- |
| **Gold** | 货币，用于商店消费。 |
| **DamagePercent** | 全局伤害加成 (乘区)。 |
| **AttackSpeed** | 减少单位攻击冷却时间。 |
| **ShopDiscount** | 降低商店物品价格。 |
| **Luck** | (预留) 影响稀有物品出现率。 |

### 3.2 单位属性 (Unit Stats)

| 属性 | 说明 |
| :--- | :--- |
| **Type** | 攻击类型：MELEE (近战), RANGED (远程), MAGIC (魔法/追踪)。 |
| **Damage** | 单次攻击伤害。 |
| **Range** | 索敌半径（像素或格子数）。 |
| **Cooldown** | 攻击间隔（秒）。 |
| **HP / MaxHP** | 生命值，归零后单位变成墓碑 (🪦)，本波次无法攻击。 |
| **Energy** | (仅英雄) 0-100，满值释放大招。 |

---

## 4. 内容库 (Content)

### 4.1 单位图鉴 (Mercenaries)

| 名称 | Emoji | 类型 | 特性 |
| :--- | :--- | :--- | :--- |
| **Keyboard Warrior** | 🦸‍♂️ | MAGIC | 英雄，全屏攻击大招，无限射程。 |
| **Militia** | 🔫 | RANGED | 基础远程单位，射程中等。 |
| **Boxer** | 🥊 | MELEE | 近战高血量，用于抗线 (Tank)。 |
| **Wizard** | 🧙‍♂️ | MAGIC | 发射追踪弹，无视行限制。 |
| **Sniper** | 🏹 | RANGED | 极高射程和伤害，但攻速极慢。 |
| **Wall-Nut** | 🌰 | ENG | 纯防御单位，极高血量，不攻击。 |

### 4.2 敌人 (Enemies)

| 名称 | Emoji | 行为 |
| :--- | :--- | :--- |
| **Troll** | 🤡 | 基础敌人，数量多。 |
| **Hater** | 😡 | 速度较快，血量中等。 |
| **Bot** | 🤖 | 精英怪，高血量。 |
| **Boss** | 👹 | 波次底关BOSS，极高血量，体型巨大。 |

---

## 5. 交互设计

*   **HUD**: 顶部显示波次时间、生命值、金币。左下角有操作提示。
*   **Drag & Drop**: 在 SHOP/DRAFT 阶段，鼠标按住单位可拖拽至其他格子，若目标格子有单位则互换位置。
*   **Shop UI**: 
    *   位于屏幕底部，可折叠/展开。
    *   商品卡片显示稀有度颜色边框。
*   **Draft UI**: 
    *   波次胜利后的模态弹窗。
    *   三选一卡片设计。

## 6. 文件结构

```
/
├── App.tsx             # 顶层组件，处理 Phase 切换和布局
├── types.ts            # 类型定义
├── constants.ts        # 游戏数值配置 (单位库、波次配置)
├── services/
│   └── GameEngine.ts   # Canvas 渲染与游戏循环核心 (ECS模式)
├── store/
│   └── useGameStore.ts # Zustand 全局状态 (Grid数据, Phase, Stats)
└── components/
    ├── HUD.tsx         # 顶部状态栏
    ├── Shop.tsx        # 商店界面
    ├── DraftModal.tsx  # 选秀/奖励界面
    ├── StartScreen.tsx # 开始界面
    └── GameOverScreen.tsx # 结束界面
```